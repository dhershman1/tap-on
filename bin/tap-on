#! /usr/bin/env node

/* Modules */
const parsedArgs = require('minimist')(process.argv.slice(2), {
  alias: {
    v: 'version',
    s: 'stack',
    u: 'summarize',
    d: 'disableColor'
  }
})
const { version } = require('../package.json')
const tapOn = require('../index.js')

/* Output */
if (parsedArgs.version) {
  console.log(version)
} else {
  process.stdin
    .pipe(tapOn(parsedArgs))
    .pipe(process.stdout)

  process.on('exit', function (status) {
    if (status === 1) {
      process.exit(1)
    }

    if (tapOn.failed) {
      process.exit(1)
    }
  })
}
